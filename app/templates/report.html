<!-- app/templates/report.html -->
{% if not pdf_mode %}
{% extends 'base.html' %}
{% block content %}
{% endif %}

<div class="container mt-4" {% if not pdf_mode %}style="margin-bottom: 2rem;"{% endif %}>

    <!-- Optional logo (if uploaded) -->
    <div>
        <img src="{{ url_for('static', filename='uploads/logo.png') }}" alt="Organization Logo" 
             style="max-height:100px;"
             onerror="this.style.display='none';">
    </div>

    <h1>Root Cause Analysis Report</h1>
    <p><strong>ID:</strong> {{ rca.id }}</p>
    <hr>

    <h3>Description of the Issue</h3>
    <p>{{ rca.issue_description }}</p>

    <h3>Date of Incident</h3>
    <p>{{ rca.incident_date }}</p>

    <h3>Description of the Incident</h3>
    <p>{{ rca.incident_description }}</p>

    <h3>Who Reported the Incident?</h3>
    <p>{{ rca.who_reported }}</p>

    <h3>Who Did It Affect?</h3>
    <p>{{ rca.who_affected }}</p>

    <h3>How Did It Affect Them?</h3>
    <p>{{ rca.how_affected }}</p>

    <h3>How Often Did the Incident Occur?</h3>
    <p>{{ rca.how_often }}</p>

    <hr>

    <h3>Timeline</h3>
    <ul>
        <li><strong>Events Before the Incident:</strong> {{ rca.events_before }}</li>
        <li><strong>Events During the Incident:</strong> {{ rca.events_during }}</li>
        <li><strong>Events After the Incident:</strong> {{ rca.events_after }}</li>
    </ul>

    <h3>Personnel</h3>
    <ul>
        <li><strong>Names of Staff Involved:</strong> {{ rca.staff_involved }}</li>
        <li><strong>Job Titles:</strong> {{ rca.job_titles }}</li>
        <li><strong>Methods for Collecting Data:</strong> {{ rca.data_collection_methods }}</li>
        <li><strong>Communication of Findings:</strong> {{ rca.communication_plan }}</li>
    </ul>

    <h3>Root Cause</h3>
    <ul>
        <li><strong>Root Cause of the Incident:</strong> {{ rca.root_cause }}</li>
        <li><strong>How Did the Root Cause Occur?</strong> {{ rca.cause_occurrence }}</li>
        <li><strong>Supporting Data:</strong> {{ rca.supporting_data }}</li>
    </ul>

    <h3>Methods / Resolution</h3>
    <ul>
        <li><strong>Steps to Resolve &amp; Prevent:</strong> {{ rca.resolution_steps }}</li>
        <li><strong>Date Resolved:</strong> {{ rca.date_resolved }}</li>
        <li><strong>Approved By:</strong> {{ rca.approved_by }}</li>
    </ul>

    <hr>
    <p><em>Created At:</em> {{ rca.created_at }}</p>
    
    {% if not pdf_mode %}
    <a class="btn btn-success" href="{{ url_for('download_report', report_id=rca.id) }}">
        Download PDF
    </a>
    {% endif %}

</div>

{% if not pdf_mode %}
{% endblock %}
{% endif %}

